#!/usr/bin/env node

var fs = require('fs');
var split = require('split');
var stream = require('stream');
var thumbnailStream = require('../index.js').ThumbnailStream({});
var dir = './tmp';
if (fs.existsSync(dir)) fs.rmdirSync(dir);
fs.mkdirSync(dir);
var writePNGStream = require('../index.js').WritePNGStream(dir);
var reader = require('cloudfront-log-reader');
var reqStream = reader.RequestStream({ baseurl: 'https://api-gl-stageyprod.tilestream.net' });

process.stdin
    .pipe(split())
    .pipe(reqStream)
    .pipe(thumbnailStream)
    .pipe(writePNGStream)
    .on('error', function(err) {
        console.error(err);
        process.exit(1);
    })
    .on('data', function(data) {
    })
    .on('end', function() {
    });


